<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wavelength – Browser Game</title>
  <style>
    :root {
      --bg: #0f1220;
      --panel: #171a2b;
      --muted: #8f97b1;
      --text: #eef2ff;
      --accent: #6ee7b7;
      --accent-2: #60a5fa;
      --danger: #f87171;
      --good: #34d399;
      --card: #121528;
      --shadow: 0 8px 30px rgba(0,0,0,.35);
      --radius: 16px;
    }
    * { box-sizing: border-box }
    html, body { height: 100% }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(1200px 700px at 20% -10%, #1d2141 0%, var(--bg) 45%),
                  radial-gradient(1200px 700px at 120% 110%, #122233 0%, var(--bg) 30%);
      color: var(--text);
    }
    .container { max-width: 1000px; margin: 0 auto; padding: 24px; }
    header { display: flex; align-items: center; gap: 12px; margin: 8px 0 16px; }
    .logo { font-weight: 800; letter-spacing: .5px; font-size: 20px; padding: 6px 12px; border-radius: 999px; background: linear-gradient(135deg,var(--accent),var(--accent-2)); color: #0a0a0a; }
    .card { background: rgba(18,21,40,.7); backdrop-filter: blur(6px); border: 1px solid rgba(255,255,255,.06); border-radius: var(--radius); box-shadow: var(--shadow); padding: 18px; }
    .row { display: flex; gap: 16px; flex-wrap: wrap; }
    .grow { flex: 1 1 0; min-width: 240px; }
    .controls { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
    button, select, input[type="number"], input[type="text"] { background: var(--panel); color: var(--text); border: 1px solid rgba(255,255,255,.08); border-radius: 12px; padding: 10px 12px; font-size: 14px; }
    button { cursor: pointer; transition: transform .06s ease, filter .15s ease; }
    button:hover { filter: brightness(1.1) }
    button:active { transform: translateY(1px) }
    .btn-primary { background: linear-gradient(135deg, var(--accent), var(--accent-2)); color: #0b1020; border: none; font-weight: 700; }
    .btn-ghost { background: transparent; border: 1px dashed rgba(255,255,255,.2) }
    .btn-danger { background: #2b1515; border-color: #5b2323; color: #ffb4b4 }
    .pill { padding: 6px 10px; border-radius: 999px; background: #0e1429; border: 1px solid rgba(255,255,255,.08); color: var(--muted); font-size: 12px }
    /* Spectrum bar */
    .spectrum { position: relative; width: 100%; height: 54px; background: linear-gradient(90deg, #374151, #1f2937); border-radius: 14px; border: 1px solid rgba(255,255,255,.08); overflow: hidden; }
    .spectrum-labels { display: flex; justify-content: space-between; font-size: 13px; color: var(--muted); margin-top: 8px; }
    .tick { position: absolute; top: 0; bottom: 0; width: 2px; background: rgba(255,255,255,.15) }
    .target { position: absolute; top: 0; bottom: 0; width: 3px; background: linear-gradient(180deg,#fff,#bfe5ff); box-shadow: 0 0 10px rgba(255,255,255,.5); transform: translateX(-1.5px); }
    .guess { position: absolute; top: 0; bottom: 0; width: 3px; background: linear-gradient(180deg,#8cffd9,#79ffe1); box-shadow: 0 0 10px rgba(110,231,183,.6); transform: translateX(-1.5px); }
    .slider-wrap { margin-top: 16px; }
    input[type="range"] { width: 100%; appearance: none; height: 6px; border-radius: 999px; background: linear-gradient(90deg, #334155, #0ea5e9); outline: none }
    input[type="range"]::-webkit-slider-thumb { appearance: none; width: 22px; height: 22px; border-radius: 50%; background: #e5faff; border: 2px solid #0ea5e9; box-shadow: 0 2px 8px rgba(14,165,233,.4) }
    .grid { display: grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 16px; }
    @media (max-width: 760px) { .grid { grid-template-columns: 1fr } }
    .small { font-size: 12px; color: var(--muted) }
    .center { text-align: center }
    .score-box { display: grid; grid-template-columns: repeat(2,1fr); gap: 10px; }
    .score { background: var(--panel); padding: 12px; border-radius: 12px; display: flex; align-items: center; justify-content: space-between; }
    .score b { font-size: 18px }
    .hidden { display: none !important }
    .kbd { padding: 2px 6px; border-radius: 6px; background: #11162a; border: 1px solid rgba(255,255,255,.08) }
    .toast { position: fixed; right: 16px; bottom: 16px; background: #0c1227; border: 1px solid rgba(255,255,255,.08); padding: 10px 12px; border-radius: 12px; box-shadow: var(--shadow); color: var(--muted); }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">Wavelength</div>
      <div class="pill">Browser edition • pass‑and‑play</div>
    </header>
    <div class="row">
      <div class="card grow" id="gameCard">
        <div class="controls" style="justify-content: space-between; margin-bottom: 8px; gap: 8px">
          <div class="controls" style="gap: 8px">
            <button class="btn-primary" id="newRoundBtn">New round (N)</button>
            <button id="peekBtn">Peek target (hold)</button>
            <button id="revealBtn">Reveal & score</button>
            <button id="resetBtn" class="btn-ghost">Reset</button>
          </div>
          <div class="small">Pro tip: Press <span class="kbd">N</span> for new round, hold <span class="kbd">T</span> to peek target, press <span class="kbd">R</span> to reveal.</div>
        </div>
        <div class="card" style="background: rgba(14,18,38,.7); border-style: dashed; margin-bottom: 12px;">
          <div class="controls">
            <label class="small">Mode</label>
            <select id="mode">
              <option value="teams">Teams</option>
              <option value="coop">Co‑op</option>
              <option value="free">Free play</option>
            </select>
            <label class="small">Round timer</label>
            <select id="timerSelect">
              <option value="0">Off</option>
              <option value="60">60s</option>
              <option value="90" selected>90s</option>
              <option value="120">120s</option>
            </select>
            <span class="pill">Win at 10 pts (teams/coop)</span>
            <span class="small" id="timerDisp">Timer: —</span>
          </div>
        </div>
        <div>
          <div class="small" id="roundInfo">Press New round to start.</div>
          <div class="spectrum" id="spectrum">
            <div class="tick" style="left:25%"></div>
            <div class="tick" style="left:50%"></div>
            <div class="tick" style="left:75%"></div>
            <div class="target hidden" id="target"></div>
            <div class="guess hidden" id="guess"></div>
          </div>
          <div class="spectrum-labels"><span id="leftLabel">—</span><span id="rightLabel">—</span></div>
          <div class="slider-wrap">
            <input type="range" min="0" max="100" value="50" id="slider" />
            <div class="controls" style="justify-content: space-between; margin-top: 8px">
              <div>
                <button id="lockBtn" class="btn-primary">Lock guess</button>
                <span class="small">Guess: <b id="guessVal">50</b> • Δ <b id="deltaVal">—</b></span>
              </div>
              <div class="small">Add custom spectrum: <input id="customLeft" type="text" placeholder="Left" size="10"/> ↔ <input id="customRight" type="text" placeholder="Right" size="10"/> <button id="addSpectrum">Add</button></div>
            </div>
          </div>
        </div>
      </div>
      <div class="card grow" id="sidebar">
        <h3 style="margin: 6px 0 6px">Scores</h3>
        <div class="score-box">
          <div class="score"><span>Team A</span><b id="scoreA">0</b></div>
          <div class="score"><span>Team B</span><b id="scoreB">0</b></div>
        </div>
        <div class="controls" style="margin-top: 10px">
          <button id="giveA">+A</button>
          <button id="giveB">+B</button>
          <button id="takeA">−A</button>
          <button id="takeB">−B</button>
        </div>
        <div class="card" style="margin-top: 14px">
          <h4 style="margin: 0 0 6px">Scoring (auto)</h4>
          <div class="small">Within 3 → 4 pts • within 10 → 3 pts • within 20 → 2 pts • within 30 → 1 pt • else 0</div>
          <div class="controls" style="margin-top: 8px">
            <button id="applyScoreA" class="btn-primary">Apply to Team A</button>
            <button id="applyScoreB" class="btn-primary">Apply to Team B</button>
          </div>
          <div class="small" id="lastScore">—</div>
        </div>
        <div class="card" style="margin-top: 14px">
          <h4 style="margin: 0 0 6px">How to play (quick)</h4>
          <ol style="margin: 0; padding-left: 18px; color: var(--muted); line-height: 1.4">
            <li>Press <b>New round</b>. Host <b>peeks the target</b> and gives a one‑phrase clue.</li>
            <li>Team discusses and <b>sets the slider</b>, then <b>Lock guess</b>.</li>
            <li>Press <b>Reveal & score</b>; award points with the buttons here.</li>
            <li>First to <b>10 points</b> wins.</li>
          </ol>
        </div>
        <div class="card" style="margin-top: 14px">
          <h4 style="margin: 0 0 6px">Options</h4>
          <div class="controls" style="gap: 8px; margin-top: 6px">
            <button id="shuffleSpectrum">Shuffle spectrum</button>
            <button id="copyShare">Copy shareable state</button>
            <button id="resetCustom" class="btn-danger">Reset customs</button>
          </div>
          <div class="small">State saves automatically in your browser.</div>
        </div>
      </div>
    </div>
    <div class="toast hidden" id="toast">Copied!</div>
  </div>
<script>
(function(){
  const defaultSpectra = [
    ["Cold", "Hot"], ["Quiet", "Loud"], ["Casual", "Formal"], ["Underrated", "Overrated"], ["Childish", "Mature"],
    ["Reality", "Fantasy"], ["Safe", "Risky"], ["Simple", "Complex"], ["Cheap", "Expensive"], ["Common", "Rare"],
    ["Introvert", "Extrovert"], ["Sweet", "Salty"], ["Healthy", "Unhealthy"], ["Classic", "Trendy"], ["Light", "Heavy"],
    ["Work", "Play"], ["Order", "Chaos"], ["City", "Nature"], ["Old", "New"], ["Art", "Science"],
    ["Practical", "Aesthetic"], ["Predictable", "Unpredictable"], ["Niche", "Mainstream"], ["Minimal", "Maximal"], ["Crisp", "Creamy"],
    ["Nerdy", "Cool"], ["Spicy", "Mild"], ["Soft", "Hard"], ["Fast", "Slow"], ["Pure", "Messy"],
  ];
  const els = id => document.getElementById(id);
  const spectrumEl = els('spectrum');
  const leftLabel = els('leftLabel');
  const rightLabel = els('rightLabel');
  const targetEl = els('target');
  const guessEl = els('guess');
  const slider = els('slider');
  const guessVal = els('guessVal');
  const deltaVal = els('deltaVal');
  const modeSel = els('mode');
  const timerSel = els('timerSelect');
  const timerDisp = els('timerDisp');
  const roundInfo = els('roundInfo');
  const scoreAEl = els('scoreA');
  const scoreBEl = els('scoreB');
  const lastScoreEl = els('lastScore');
  let state = {
    spectra: JSON.parse(localStorage.getItem('wavelength_spectra')||'null') || defaultSpectra.slice(),
    scoreA: +(localStorage.getItem('wavelength_scoreA')||0),
    scoreB: +(localStorage.getItem('wavelength_scoreB')||0),
    mode: localStorage.getItem('wavelength_mode')||'teams',
    timer: +(localStorage.getItem('wavelength_timer')||90),
    round: 0,
    current: null, // {left,right,target,locked,guess}
    timerId: null, endsAt: 0,
  };
  function save(){
    localStorage.setItem('wavelength_spectra', JSON.stringify(state.spectra));
    localStorage.setItem('wavelength_scoreA', state.scoreA);
    localStorage.setItem('wavelength_scoreB', state.scoreB);
    localStorage.setItem('wavelength_mode', state.mode);
    localStorage.setItem('wavelength_timer', state.timer);
  }
  function rnd(n){ return Math.floor(Math.random()*n) }
  function clamp(n,min,max){ return Math.max(min, Math.min(max, n)) }
  function setPos(el, pct){ el.style.left = pct + '%'; }
  function show(el, v){ el.classList.toggle('hidden', !v) }
  function newRound(shuffle=true){
    if(shuffle){
      const s = state.spectra[rnd(state.spectra.length)];
      state.current = { left: s[0], right: s[1], target: rnd(101), locked: false, guess: 50 };
    } else if(!state.current){
      state.current = { left: 'Left', right: 'Right', target: rnd(101), locked: false, guess: 50 };
    } else {
      state.current.target = rnd(101); state.current.locked = false; state.current.guess = 50;
    }
    leftLabel.textContent = state.current.left;
    rightLabel.textContent = state.current.right;
    setPos(targetEl, state.current.target);
    setPos(guessEl, state.current.guess);
    show(targetEl, false);
    show(guessEl, false);
    slider.value = 50; guessVal.textContent = '50'; deltaVal.textContent = '—';
    state.round++;
    roundInfo.textContent = `Round ${state.round} — Host: peek the target and give a clue.`;
    if(state.timer>0){ startTimer(state.timer) } else { stopTimer() }
    save();
  }
  function startTimer(seconds){
    stopTimer();
    state.endsAt = Date.now() + seconds*1000;
    tick();
    state.timerId = setInterval(tick, 200);
  }
  function stopTimer(){
    if(state.timerId) clearInterval(state.timerId);
    state.timerId = null; timerDisp.textContent = 'Timer: —';
  }
  function tick(){
    const left = Math.max(0, Math.floor((state.endsAt - Date.now())/1000));
    timerDisp.textContent = 'Timer: ' + left + 's';
    if(left<=0){ clearInterval(state.timerId); state.timerId=null; ping('Time! Reveal & score.'); }
  }
  function computeScore(){
    if(!state.current || !state.current.locked) return {points:0, delta:null};
    const d = Math.abs(state.current.guess - state.current.target);
    let pts = 0;
    if(d<=3) pts=4; else if(d<=10) pts=3; else if(d<=20) pts=2; else if(d<=30) pts=1; else pts=0;
    return {points: pts, delta: d};
  }
  function award(team){
    const {points, delta} = computeScore();
    if(delta==null){ ping('Lock a guess first.'); return }
    if(state.mode==='free'){ ping('Free play: scoring is manual.'); return }
    if(state.mode==='coop'){
      state.scoreA += points;
      scoreAEl.textContent = state.scoreA;
      lastScoreEl.textContent = `Co‑op gained ${points} (Δ ${delta}).`;
      if(state.scoreA>=10) { ping('Co‑op wins!'); }
    } else {
      if(team==='A'){ state.scoreA += points; scoreAEl.textContent = state.scoreA; lastScoreEl.textContent = `Team A +${points} (Δ ${delta}).`; }
      else { state.scoreB += points; scoreBEl.textContent = state.scoreB; lastScoreEl.textContent = `Team B +${points} (Δ ${delta}).`; }
      if(state.scoreA>=10) ping('Team A wins!');
      if(state.scoreB>=10) ping('Team B wins!');
    }
    save();
  }
  function ping(msg){
    const t = els('toast');
    t.textContent = msg; t.classList.remove('hidden');
    setTimeout(()=>t.classList.add('hidden'), 1600);
  }
  slider.addEventListener('input', (e)=>{
    const v = +e.target.value; guessVal.textContent = v; if(state.current){ state.current.guess = v; setPos(guessEl, v); }
  });
  els('lockBtn').addEventListener('click', ()=>{
    if(!state.current){ ping('Start a round first.'); return }
    state.current.locked = true;
    setPos(guessEl, state.current.guess);
    show(guessEl, true);
    deltaVal.textContent = Math.abs(state.current.guess - state.current.target);
  });
  els('newRoundBtn').addEventListener('click', ()=> newRound(true));
  els('revealBtn').addEventListener('click', ()=>{
    if(!state.current){ ping('No round in progress.'); return }
    show(targetEl, true);
  });
  els('peekBtn').addEventListener('mousedown', ()=> show(targetEl, true));
  els('peekBtn').addEventListener('touchstart', (e)=>{ e.preventDefault(); show(targetEl, true) }, {passive:false});
  const hideTarget = ()=> show(targetEl, false);
  els('peekBtn').addEventListener('mouseup', hideTarget);
  els('peekBtn').addEventListener('mouseleave', hideTarget);
  els('peekBtn').addEventListener('touchend', hideTarget);
  els('applyScoreA').addEventListener('click', ()=> award('A'));
  els('applyScoreB').addEventListener('click', ()=> award('B'));
  els('giveA').addEventListener('click', ()=>{ state.scoreA++; scoreAEl.textContent=state.scoreA; save(); });
  els('giveB').addEventListener('click', ()=>{ state.scoreB++; scoreBEl.textContent=state.scoreB; save(); });
  els('takeA').addEventListener('click', ()=>{ state.scoreA=Math.max(0,state.scoreA-1); scoreAEl.textContent=state.scoreA; save(); });
  els('takeB').addEventListener('click', ()=>{ state.scoreB=Math.max(0,state.scoreB-1); scoreBEl.textContent=state.scoreB; save(); });
  els('shuffleSpectrum').addEventListener('click', ()=>{
    if(!state.current){ newRound(true); return }
    const s = state.spectra[rnd(state.spectra.length)];
    state.current.left = s[0]; state.current.right = s[1];
    leftLabel.textContent = s[0]; rightLabel.textContent = s[1];
    ping('Shuffled spectrum.');
    save();
  });
  els('copyShare').addEventListener('click', ()=>{
    const payload = {
      m: state.mode, t: state.timer, a: state.scoreA, b: state.scoreB,
      c: state.current ? {L: state.current.left, R: state.current.right, T: state.current.target} : null
    };
    navigator.clipboard.writeText(location.origin + location.pathname + '#'+ btoa(unescape(encodeURIComponent(JSON.stringify(payload)))))
      .then(()=> ping('Copied link with state!'))
      .catch(()=> ping('Copied state (fallback).'));
  });
  els('resetCustom').addEventListener('click', ()=>{
    state.spectra = defaultSpectra.slice(); save(); ping('Custom spectra cleared.');
  });
  modeSel.value = state.mode; timerSel.value = String(state.timer);
  scoreAEl.textContent = state.scoreA; scoreBEl.textContent = state.scoreB;
  modeSel.addEventListener('change', (e)=>{ state.mode = e.target.value; save(); });
  timerSel.addEventListener('change', (e)=>{
    state.timer = +e.target.value; save();
    if(state.timer>0 && state.current){ startTimer(state.timer) } else { stopTimer() }
  });
  els('addSpectrum').addEventListener('click', ()=>{
    const L = els('customLeft').value.trim();
    const R = els('customRight').value.trim();
    if(L && R){ state.spectra.push([L,R]); save(); els('customLeft').value=''; els('customRight').value=''; ping('Added!'); }
  });
  document.addEventListener('keydown', (e)=>{
    if(e.key==='n' || e.key==='N') newRound(true);
    if(e.key==='r' || e.key==='R') show(targetEl, true);
    if(e.key==='t' || e.key==='T') show(targetEl, true);
  });
  document.addEventListener('keyup', (e)=>{
    if(e.key==='r' || e.key==='R' || e.key==='t' || e.key==='T') show(targetEl, false);
  });
  try {
    if(location.hash.length>1){
      const data = JSON.parse(decodeURIComponent(escape(atob(location.hash.slice(1)))));
      if(data){
        state.mode = data.m || state.mode; modeSel.value = state.mode;
        state.timer = +data.t || state.timer; timerSel.value = String(state.timer);
        state.scoreA = +data.a || 0; state.scoreB = +data.b || 0;
        scoreAEl.textContent = state.scoreA; scoreBEl.textContent = state.scoreB;
        if(data.c){
          state.current = {left:data.c.L,right:data.c.R,target:clamp(+data.c.T,0,100),locked:false,guess:50};
          leftLabel.textContent = state.current.left; rightLabel.textContent = state.current.right;
          setPos(targetEl, state.current.target); show(targetEl, false); show(guessEl, false);
          roundInfo.textContent = 'Shared round loaded — press Peek to view target.';
        }
      }
    }
  } catch(e){ console.warn('Failed to parse share state', e) }
  newRound(true);
})();
</script>
</body>
</html>
